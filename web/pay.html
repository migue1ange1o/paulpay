<!DOCTYPE html>
<html>
<head>
   <title>PayPaul Payment</title>
        {{if eq .Currency "SOL"}}
            <link href=sol.svg rel=icon>
        {{else if eq .Currency "XMR"}}
            <link href=xmr.svg rel=icon>
        {{else if eq .Currency "ETH"}}
            <link href=eth.svg rel=icon>
        {{else if eq .Currency "BUSD"}}
            <link href=busd.svg rel=icon>
        {{else if eq .Currency "HEX"}}
            <link href=hex.svg rel=icon>
        {{else if eq .Currency "MATIC"}}
            <link href=matic.svg rel=icon>
        {{else if eq .Currency "PAINT"}}
            <link href=paint.svg rel=icon>
        {{else if eq .Currency "PNK"}}
            <link href=pnk.svg rel=icon>
        {{else if eq .Currency "SHIB"}}
            <link href=shiba_inu.svg rel=icon>
        {{else if eq .Currency "TUSD"}}
            <link href=tether.svg rel=icon>
        {{else if eq .Currency "USDC"}}
            <link href=usdc.svg rel=icon>
        {{else if eq .Currency "WBTC"}}
            <link href=wbtc.svg rel=icon>
        {{end}}
    <link href=style.css rel=stylesheet>

</head>
<body>
    <h2>Send exactly <b>{{.Amount}}</b> {{.Currency}} to confirm superchat:</h2>

    <small>
    <p id="donation-status">
        <img src="loader.svg" class="loading-wheel" alt="Loading wheel"> Checking For Donation...
    </p>
</small>

<label>Name:</label><br>
<blockquote>
    {{.Name}}
</blockquote>
<label>Message:</label><br>
<blockquote>
    {{.Message}}
</blockquote>

{{if ne .Media ""}}
    <label>Media:</label><br>
    <blockquote>
        {{.Media}}
    </blockquote>
{{end}}

<label>Payment Address</label><br>
<blockquote style="user-select: all">
    {{.Address}}
</blockquote>
<label>Or scan:</label><br>
<blockquote>
    <img src="data:image/png;base64,{{.QRB64}}"/>
</blockquote>


       
<small>Stay on this screen until transaction is seen.</small><br>
<footer>
    <small><small>
      <p>PayPaul &copy; 2023. Developed by <a href="http://www.paul.town/" target="_blank">Paul Town</a> with <a href="https://github.com/pautown/paulpay" target="_blank">PayPaul GitHub Source Code</a></p>
    </small></small>
  </footer>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
   $(document).ready(function() {
      console.log("Document is ready"); // Add this line
      var donation_id = "{{.DonationID}}";
      var status_indicator = $(".donation-status");
      updateDonationStatus(donation_id, status_indicator);
      var interval_id = setInterval(function() {
        updateDonationStatus(donation_id, status_indicator);
      }, 5000);

      // Stop the interval when the status is complete
      if (status_indicator.hasClass("complete")) {
        clearInterval(interval_id);
      }
    });

    function updateDonationStatus(donation_id, status_indicator) {
      console.log("Checking donation status...");
      $.ajax({
        url: "/check_donation_status/",
        data: {donation_id: donation_id},
        success: function(data) {
          if (data == 'true') {
            console.log("Donation received");
            status_indicator.find(".loading-wheel").remove();
            status_indicator.append('<img src="checkmark.png" class="checkmark" alt="Checkmark">');
            status_indicator.addClass("complete");
            document.title = "Donation Received, Thank You!";
            blinkTab();
            clearInterval(interval_id);
          } else {
            console.log(data)
            console.log("Donation not received");
          }
        },
        error: function() {
          console.log("Error checking donation status");
        }
      });
    }


    function blinkTab() {
        var oldTitle = document.title;
        var timeoutId;

        function blink() {
            document.title = (document.title == oldTitle) ? "Donation Received, Thank You!" : oldTitle;
        }

        function clear() {
            clearInterval(timeoutId);
            document.title = oldTitle;
            window.onmousemove = null;
            timeoutId = null;
        }

        if (!timeoutId) {
            timeoutId = setInterval(blink, 1000);
            window.onmousemove = clear;
        }
    }

</script>


</html>
