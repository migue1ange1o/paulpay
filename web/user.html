<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>User Page</title>
  <link href=style.css rel=stylesheet>
  <script>
    var MediaEnabled = {{ if .MediaEnabled }} true {{ else }} false {{ end }};

function toggleDonos() { 
  MediaEnabled = !MediaEnabled
  var button = document.getElementById("toggle-media-donos");
  var elements = document.querySelectorAll('p, textarea')

  if (MediaEnabled) {
    button.innerHTML = "Turn Media Donations OFF";
    document.getElementById("media-status").innerHTML = "Media donations are currently enabled";
  } else {
    button.innerHTML = "Turn Media Donations ON";
    document.getElementById("media-status").innerHTML = "Media donations are currently <b>disabled</b>";
  }
}


window.onload = function() {
  const form = document.querySelector('form');
  const newPasswordInput = document.getElementById('new-password');
  const newPasswordConfirmInput = document.getElementById('new-password-confirm');
  const submitButton = document.getElementById('change-password');
  

  let amountThisMonth = {{.BillingData.AmountThisMonth}};
let threePercent = amountThisMonth * 0.03;
document.getElementById('threePercent').textContent = `$${threePercent.toFixed(2)}`;


  function validatePassword() {
    if (newPasswordInput.value !== newPasswordConfirmInput.value) {
      newPasswordConfirmInput.setCustomValidity("Passwords don't match");
      submitButton.disabled = true;
      submitButton.textContent = "Passwords Don't Match";
    } else if (newPasswordInput.value === '' || newPasswordConfirmInput.value === '') {
      submitButton.disabled = true;
      submitButton.textContent = "Change Password";
    } else {
      newPasswordConfirmInput.setCustomValidity('');
      submitButton.disabled = false;
      submitButton.textContent = "Change Password";
    }
  }

  newPasswordInput.addEventListener('input', validatePassword);
  newPasswordConfirmInput.addEventListener('input', validatePassword);

  form.addEventListener('submit', function(event) {
    if (newPasswordInput.value !== newPasswordConfirmInput.value) {
      event.preventDefault();
      alert('Passwords do not match');
    }
  });

   // Get the creation date string from the server-side template
  const creationDateStr = "{{.CreationDatetime}}";

  // Parse the string into a Date object
  const creationDate = new Date(creationDateStr);

  // Format the date into a human-readable string
  const formattedDate = creationDate.toLocaleString();

  // Set the formatted date as the text content of the <span> element
  document.getElementById("creation-date").textContent = formattedDate;

 // Get the current date as a Date object
  const currentDate = new Date();

  // Add one month to the current date
  const nextMonthDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1);

  // Set the target date to the first day of the next month
  const targetDate = new Date(nextMonthDate.getFullYear(), nextMonthDate.getMonth(), 1);

  // Calculate the difference between the current date and the target date
  const timeDiff = targetDate.getTime() - currentDate.getTime();
  const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

  // Update the text content of the <span> element with the number of days left
  document.getElementById("days-left").textContent = daysLeft.toString();


};


 

  </script>
</head>
<body>
  <br>
  <h1>User Settings Panel</h1>
  <hr>

<div style="display: flex; align-items: center; margin-right: 10px;">
      <form method="GET" action="/user">
        <button style="padding: 0 10px 0;">User Settings</button>
      </form>
      <form method="GET" action="/userobs">
        <button style="padding: 0 10px; margin-right: 10px; display: inline-block;">OBS Settings</button>
      </form>
      <form method="GET" action="/viewdonos">
        <button style="padding: 0 10px 0;">View Donations</button>
      </form>
      {{ if eq .Username "admin" }}
      <form method="GET" action="/usermanager">
        <button style="padding: 0 10px 0;">Admin Dash</button>
      </form>
      {{ end }}
  </div>



  <br><br>
<small><p> <b style="color: lightsteelblue;">Account {{.Username}} created on:</b> <span id="creation-date"></span></p></small>
  <p> <b style="color: lightsteelblue;"> Total Earnings: </b> ${{.BillingData.AmountTotal}}</p>
  <p>
  <b style="color: lightsteelblue;"> Monthly Earnings: </b> ${{.BillingData.AmountThisMonth}} <b style="color: lightsteelblue;">  <small>(3% Fee: </b> <span id="threePercent"></span>) </small></p>
  <button type="button">
      <b style="color: lightsteelblue;"> Days until next payment: </b> 
      <span id="days-left"></span>
  </button>
    


  
  
  <p id="media-status"> <b style="color: lightsteelblue;">Monero Wallet: </b> {{ if .WalletUploaded }}<b style="color: lightseagreen;">uploaded</b>{{ else }}<b>not yet uploaded.</b>{{ end }}</p>
  <form method="GET" action="/cryptosettings">
    <button style="padding: 0 10px; margin-right: 10px; display: inline-block;">View/Change Crypto Settings</button>
  </form>


  
  
 <br>
 <br>


  
  <hr>
    <br>
    <h2>Change Password</h2>
  <form method="POST" action="/changepassword">
    <label for="current-password">Current Password:</label>
    <input type="password" id="current-password" name="current_password" required><br><br>
    <label for="new-password">New Password:</label>
    <input type="password" id="new-password" name="new_password" required><br><br>
    <label for="new-password-confirm">Confirm New Password:</label>
<input type="password" id="new-password-confirm" name="new_password_confirm" required><br><br>
    <button type="submit" id="change-password">Change Password</button>
</form>

  <hr><br><br><br>
  <form method="POST" action="/logout">
    <input type="submit" value="Logout">
  </form>
</body>
</html>